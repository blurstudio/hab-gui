[tox]
envlist = begin,py{37,38,39,310,311},end,black,flake8,qt-enum
skip_missing_interpreters = True

[testenv]
changedir = {toxinidir}
skip_install = True
package = editable
deps =
    -rrequirements.txt
    covdefaults
    coverage
    pytest
commands =
    coverage run -m pytest {tty:--color=yes} {posargs:tests/}

[testenv:qt-enum]
# Check for any enum regressions and fail if found.
basepython = python3
deps =
    Qt.py>=1.4.7
    PySide2
commands =
    python {envsitepackagesdir}/Qt_convert_enum.py . --check

[testenv:qt-enum-fix]
# Use this to automatically fix issues detected by the other qt-enum toxenv.
# This simply adds the --write argument to its check.
basepython = python3
deps =
    Qt.py>=1.4.7
    PySide2
commands =
    python {envsitepackagesdir}/Qt_convert_enum.py . --check --write

[testenv:begin]
basepython = python3
deps =
    coverage[toml]
    build
commands =
    coverage erase

[testenv:py{37,38,39,310,311}]
depends = begin
skip_install = False

[testenv:end]
basepython = python3
depends =
    begin
    py{37,38,39,310,311}
parallel_show_output = True
deps =
    coverage
commands =
    coverage combine
    coverage report

[testenv:black]
basepython = python3
deps =
    black==22.12.0
commands =
    black . --check

[testenv:flake8]
basepython = python3
deps =
    flake8-bugbear==22.12.6
    Flake8-pyproject
    flake8==5.0.4
    pep8-naming==0.13.3
commands =
    flake8 .
